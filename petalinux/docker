FROM ubuntu:20.04

RUN apt-get update && apt-get -y upgrade 

RUN dpkg --add-architecture i386
RUN apt-get update

RUN apt-get install -y tofrodos
RUN apt-get install -y iproute2
RUN apt-get install -y gawk
RUN apt-get install -y xvfb
RUN apt-get install -y git
RUN apt-get install -y make
RUN apt-get install -y net-tools
RUN apt-get install -y libncurses5-dev
RUN apt-get install -y tftpd
RUN apt-get install -y zlib1g-dev:i386
RUN apt-get install -y libssl-dev
RUN apt-get install -y flex
RUN apt-get install -y bison
RUN apt-get install -y libselinux1
RUN apt-get install -y gnupg
RUN apt-get install -y wget
RUN apt-get install -y diffstat
RUN apt-get install -y chrpath
RUN apt-get install -y socat
RUN apt-get install -y xterm
RUN apt-get install -y autoconf
RUN apt-get install -y libtool
RUN apt-get install -y tar
RUN apt-get install -y unzip
RUN apt-get install -y texinfo
RUN apt-get install -y zlib1g-dev
RUN apt-get install -y gcc-multilib
RUN apt-get install -y build-essential
RUN apt-get install -y libsdl1.2-dev
RUN apt-get install -y libglib2.0-dev
RUN apt-get install -y screen
RUN apt-get install -y pax
RUN apt-get install -y gzip

RUN apt-get install -y lsb-release
RUN apt-get install -y locales
RUN apt-get install -y cpio
RUN apt-get install -y sudo

RUN echo "%sudo ALL=(ALL:ALL) ALL" >> /etc/sudoers
RUN echo "%sudo ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# set locale values
RUN locale-gen en_US.UTF-8
ENV LANG en_US.UTF-8  
ENV LANGUAGE en_US:en  
ENV LC_ALL en_US.UTF-8 

# make /bin/sh symlink to bash instead of dash:
RUN echo "dash dash/sh boolean false" | debconf-set-selections
RUN DEBIAN_FRONTEND=noninteractive dpkg-reconfigure dash

#Do not use root account to install petalinux.
RUN useradd petalinux
RUN mkdir -p /home/petalinux/projects
RUN chown -R petalinux:petalinux /home/petalinux
RUN chmod +w /opt
RUN mkdir -p /opt/pkg/petalinux
RUN chown -R petalinux:petalinux /opt
USER petalinux

# copy Petalinux installer 
COPY --chown=petalinux:petalinux ./src/petalinux.run /home/petalinux/petalinux.run

RUN chmod a+x /home/petalinux/petalinux.run

CMD ["/bin/bash"]
